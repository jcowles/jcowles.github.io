<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>API Overview</title>
<link rel="icon" type="image/png" href="images/icon.png">
<link rel="stylesheet" href="css/rst.css" type="text/css" />
<link rel="stylesheet" href="css/default.css" type="text/css" />
<link rel="stylesheet" href="css/flavor.css" type="text/css" />
<link rel="stylesheet" href="css/renderman-university.css" type="text/css" />
<link rel="stylesheet" href="css/pygments.css" type="text/css" />
<style>
#mainContentContainer {
    left: 15px;
    margin-left: 255px;
}
ul.creatorFooterNav {
    margin-left: 100px;
}
.navigation {
    background-color: #333333;
    margin-top: 10px;
    margin-left: 10px;
}
ul.creatorMainNav li a {
    font-size: 12px !important;
}
</style>
</head>
<body>

<div class="navigation">
    <br>
    <div class="searchBar">
        <form action="search.html">
            <input type="text" name="q" id="searchInput" />
            <input type="button" id="searchButton" onclick="this.form.submit();" value="Search" />
        </form>
    </div>
    <div class="quickLinks">
        <ul>
            <li><a href="intro.html">はじめに</a></li>
                <ul>
                    <li><a href="license.html">ライセンス (en)</a></li>
                    <li><a href="getting_started.html">始めよう (en)</a></li>
                    <li><a href="contributing.html">参加しよう (en)</a></li>
                    <li><a href="cmake_build.html">ビルド方法 (en)</a></li>
                    <li><a href="code_examples.html">コード例 (en)</a></li>
                    <li><a href="roadmap.html">ロードマップ (en)</a></li>
                </ul>
            <p></p>
            <li><a href="intro_30.html">リリース 3.0</a></li>
                <ul>
                    <li><a href="intro_30.html">概要</a></li>
                    <li><a href="porting.html">2.0から3.0への移植ガイド (en)</a></li>
                    <li><a href="compatibility.html">サブディビジョンの互換性 (en)</a></li>
                </ul>
            <p></p>
            <li><a href="subdivision_surfaces.html">サブディビジョンサーフェス</a>
                <ul>
                    <li><a href="subdivision_surfaces.html#introduction">はじめに</a></li>
                    <li><a href="subdivision_surfaces.html#arbitrary-topology">トポロジ</a></li>
                    <li><a href="subdivision_surfaces.html#uniform-subdivision">均一分割</a></li>
                    <li><a href="subdivision_surfaces.html#feature-adaptive-subdivision">適応分割</a></li>
                    <li><a href="subdivision_surfaces.html#boundary-interpolation-rules">境界補間則</a></li>
                    <li><a href="subdivision_surfaces.html#face-varying-interpolation-rules">面変化境界補間則</a></li>
                    <li><a href="subdivision_surfaces.html#semi-sharp-creases">セミシャープクリース</a></li>
                    <li><a href="mod_notes.html">モデリングのコツ (en)</a></li>
                </ul>
            </li>
            <p></p>
            <li><a href="api_overview.html">OpenSubdiv ユーザーガイド</a>
                <ul>
                    <li><a href="api_overview.html">API概要</a>
                        <li><a href="sdc_overview.html">Sdc (en)</a></li>
                        <li><a href="vtr_overview.html">Vtr (en)</a></li>
                        <li><a href="far_overview.html">Far (en)</a></li>
                        <ul>
                            <li><a href="far_overview.html#far-topologyrefiner">Topology Refiner (en)</a></li>
                            <li><a href="far_overview.html#far-topologyrefinerfactory">Topology Refiner Factory (en)</a></li>
                            <li><a href="far_overview.html#far-primvarrefiner">Primvar Refiner (en)</a></li>
                            <li><a href="far_overview.html#far-patchtable">Patch Table (en)</a></li>
                            <li><a href="far_overview.html#far-stenciltable">Stencil Table v</a></li>
                        </ul>
                        <li><a href="osd_overview.html">Osd (en)</a></li>
                        <ul>
                            <li><a href="osd_shader_interface.html">シェーダインタフェース (en)</a></li>
                        </ul>
                    </li>
                    <p></p>
                    <li><a href="tutorials.html">チュートリアル (en)</a>
                    <p></p>
                    <li><a href="hbr_overview.html">過去の情報 (en)</a></li>
                    <ul>
                        <li><a href="hbr_overview.html">Hbr (en)</a></li>
                        <ul>
                            <li><a href="using_osd_hbr.html">Using Hbr (en)</a></li>
                        </ul>
                        <li><a href="hedits.html">階層エディット (en)</a></li>
                    </ul>
                </ul>
            </li>
            <p></p>
            <li><a href="additional_resources.html">追加情報 (en)</a>
                <ul>
                    <li><a href="http://graphics.pixar.com/opensubdiv/forum.html">フォーラム</a>
                    <li><a href="additional_resources.html#links">リンク</a>
                    <li><a href="additional_resources.html#videos">ビデオ</a>
                </ul>
            <p></p>
            <li><a href="release_notes.html">リリースノート</a>
            <p></p>
            <li><a href="doxy_html/index.html" target="_blank">Doxygen</a></li>
        </ul>
    </div>
    <br>
</div>

<div class="document" id="api-overview">
<h1 class="title">API Overview</h1>


    <div id="mainContentContainer">
        <div class="fullWidth headerColor">
            <div class="center">
                <div id="mainSiteNavigation">
                    <div class="homeRenderManLink">
                        <a href="http://graphics.pixar.com/opensubdiv/index.html"><img alt="OpenSubdiv Logo" src="images/opensubdiv_logo_header.png"></a>
                    </div>
          
					<!-- TOP NAVIGATION MENU -->
                    <ul class="creatorMainNav floatLeft" id="menu">
                        <li class="creatorMainNav">
                            <a href="release_notes.html">3.0.0</a>
                        </li>
                    </ul>
                    <ul class="creatorMainNav floatNav" id="menu">
                        <li class="mainSubNavigation marginR12 marginL12" id="navbarId-23704">
                            <a href="intro.html">User Docs</a>
                        </li>
                        <li class="mainSubNavigation marginR12 marginL12" id="navbarId-23887">
                            <a href="doxy_html/index.html">API Docs</a>
                        </li>
                        <li class="mainSubNavigation marginR12 marginL12" id="navbarId-23944">
                            <a href="release_notes.html">Release Notes</a>
                        </li>
                        <li class="mainSubNavigation marginR15 marginL12" id="navbarId-23703">
                            <a href="http://graphics.pixar.com/opensubdiv/forum.html">Forum</a>
                        </li>
                        <a class="blueButton marginR0 marginL0" style="width:70px" href="https://github.com/PixarAnimationStudios/OpenSubdiv">Github</a>
                    </ul>
                </div><!-- close mainSiteNavigation -->
            </div><!-- close center -->
        </div><!-- close fullWidth -->


        <div class="clearBoth"></div>
        
        <h1 class="articleContentTitle">API Overview</h1>
        
        <div class="clearBoth"></div>
        
        <hr>
        
        <div class="clearBoth"></div>
        
        <div class="coursewareBackground">

          <!-- <div class="topicLeftData-IntroPara"></div> -->
          <div class="topicLeftData-MainData">
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#api" id="id6">API レイヤー</a></li>
<li><a class="reference internal" href="#id1" id="id7">どのAPIを使うのか</a></li>
<li><a class="reference internal" href="#id2" id="id8">利用例１：単純なサブディビジョン</a></li>
<li><a class="reference internal" href="#gl" id="id9">利用例２：GLでアニメーションするメッシュを適応型テセレーションで描画</a></li>
<li><a class="reference internal" href="#id5" id="id10">チュートリアルと例</a></li>
</ul>
</div>
<a class="reference external image-reference" href="images/osd_splash.png"><img alt="images/osd_splash.png" class="align-center" src="images/osd_splash.png" /></a>
<div class="section" id="api">
<h3>API レイヤー</h3>
<p>OpenSubidv はいくつかのレイヤーで構成されたライブラリです。この構造は様々な計算リソース
（デバイス）を用いて、開発者が必要なレイヤーを必要に応じて使えるようにできています。
いくつかのレイヤーがありますが、外向きのインタフェースと内部用のものとがあります。</p>
<p>レイヤー一覧:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr><td><div class="first last line-block">
<div class="line"><strong>Sdc</strong></div>
<div class="line">サブディビジョンコア</div>
<div class="line"><a class="reference external" href="sdc_overview.html">Sdc Overview</a></div>
</div>
</td>
<td>最も低レベルのレイヤーで、サブディジョンの中核アルゴリズムを実装しており
一貫性のある結果を保証します。ほとんどの場合は単純な公開型と定数を利用する
です。</td>
</tr>
<tr><td><div class="first last line-block">
<div class="line"><strong>Vtr</strong></div>
<div class="line">ベクトル化トポロジ表現</div>
<div class="line"><a class="reference external" href="vtr_overview.html">Vtr Overview</a></div>
</div>
</td>
<td>効率的な分割のためのトポロジの中間表現を表すクラス群があります。
<em>Vtr</em> はライブラリの内部用で、公開インタフェースではありません</td>
</tr>
<tr><td><div class="first last line-block">
<div class="line"><strong>Far</strong></div>
<div class="line">特徴適応型表現</div>
<div class="line"><a class="reference external" href="far_overview.html">Far Overview</a></div>
</div>
</td>
<td>クライアントが与えるジオメトリを <em>Osd</em> で並列処理可能な連続データに変換する
中心となるインタフェースです。また <em>Far</em> 単独でもシングルスレッドの完全な
サブディビジョン及び補間アルゴリズムが利用できます。</td>
</tr>
<tr><td><div class="first last line-block">
<div class="line"><strong>Osd</strong></div>
<div class="line">OpenSubdiv クロスプラットフォーム</div>
<div class="line"><a class="reference external" href="osd_overview.html">Osd Overview</a></div>
</div>
</td>
<td>様々なデバイスでの並列サブディビジョンカーネルおよび描画ユーティリティ
を実装したクラス群です。TBB, CUDA, OpenCL, GLSL, DirectX などをサポート
しています。</td>
</tr>
</tbody>
</table>
<p>クライアントのメッシュデータは Far レイヤーを使って OpenSubdiv に与えます。通常は
結果は Osd レイヤーで受け取りますが、Far レイヤーだけで使うこともできます。</p>
<p>トポロジや頂点データを OpenSubdiv に与える方法はいくつかありますが、最終的には
Vtr と Sdc を使ってトポロジ解析が行われます。</p>
<img alt="images/api_layers_3_0.png" class="align-center" src="images/api_layers_3_0.png" />
</div>
<div class="section" id="id1">
<h3>どのAPIを使うのか</h3>
<p>OpenSubdiv の階層インタフェースは柔軟にできているので、様々なアプリケーションを
高速かつ堅牢にすることができます。ただ多くのクラスや機能があるため正しい方法を
見つけるのが難しい場合もあります。ここに一般的な用途をいくつかあげておきます。</p>
<p>アプリケーションが必要な機能:</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr><td>リミットサーフェス</td>
<td>スムーズサーフェスの表現はポリゴンの近似で行っている
アプリケーションがほとんどですが、双３次パッチでは
C <sup>2</sup> 連続なパッチを使うことが出来ます
(例: 変形するディスプレイスメントマップ、スムーズ
法線、セミシャープクリースなど)</td>
</tr>
<tr><td>変形サーフェス</td>
<td>オフラインレンダラでは通常一度に一枚のフレームを生成
しますが、インタラクティブなゲームなどでは毎フレーム
変形するキャラクターのサーフェスを計算する必要があり
ます。メッシュのトポロジが変わらなければ、大部分の
計算をまとめて事前に行うことができるため、OpenSubdiv
はステンシルテーブルを使って事前計算により効率的な
サブディビジョンを行います。</td>
</tr>
<tr><td>マルチスレッド</td>
<td>OpenSubdiv は CPU や GPU など様々なデバイスやAPI
における並列性を活かしたインタフェースを提供しています</td>
</tr>
<tr><td>GPU 描画</td>
<td>アプリケーションがインタラクティブな描画を行う場合、
OpenSubdivの D3D11/OpenGL バックエンドが利用できます。
これらはプログラマブルシェーディングを完全にサポート
しています。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id2">
<h3>利用例１：単純なサブディビジョン</h3>
<p>以下に示すのは均一分割によってサブディビジョンを行う最も簡単な例です。</p>
<img alt="images/usecase1_image.png" src="images/usecase1_image.png" />
<img alt="images/usecase1.png" class="align-center" src="images/usecase1.png" />
<ol class="arabic simple">
<li>分割をしたい頂点データクラスを定義します。
このクラスは Clear() および AddWithWeight() を実装する必要があります。</li>
</ol>
<pre class="code c++ literal-block">
<span class="keyword">struct</span> <span class="name">Vertex</span> <span class="punctuation">{</span>
    <span class="keyword type">void</span> <span class="name">Clear</span><span class="punctuation">()</span> <span class="punctuation">{</span> <span class="name">x</span> <span class="operator">=</span> <span class="name">y</span> <span class="operator">=</span> <span class="name">z</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="punctuation">}</span>
    <span class="keyword type">void</span> <span class="name">AddWithWeight</span><span class="punctuation">(</span><span class="name">Vertex</span> <span class="keyword">const</span> <span class="operator">&amp;</span><span class="name">src</span><span class="punctuation">,</span> <span class="keyword type">float</span> <span class="name">weight</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="name">x</span> <span class="operator">+=</span> <span class="name">weight</span> <span class="operator">*</span> <span class="name">src</span><span class="punctuation">.</span><span class="name">x</span><span class="punctuation">;</span>
        <span class="name">y</span> <span class="operator">+=</span> <span class="name">weight</span> <span class="operator">*</span> <span class="name">src</span><span class="punctuation">.</span><span class="name">y</span><span class="punctuation">;</span>
        <span class="name">z</span> <span class="operator">+=</span> <span class="name">weight</span> <span class="operator">*</span> <span class="name">src</span><span class="punctuation">.</span><span class="name">z</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>
    <span class="keyword type">float</span> <span class="name">x</span><span class="punctuation">,</span> <span class="name">y</span><span class="punctuation">,</span> <span class="name">z</span><span class="punctuation">;</span>
<span class="punctuation">};</span>
</pre>
<ol class="arabic simple" start="2">
<li><a class="reference external" href="far_overview.html#far-topologyrefiner">Far::TopologyRefiner</a> を
<a class="reference external" href="far_overview.html#far-topologyrefinerfactory">Far::TopologyDescriptor</a> から作成します。</li>
</ol>
<pre class="code c++ literal-block">
<span class="name">Far</span><span class="operator">::</span><span class="name">TopologyDescriptor</span> <span class="name">desc</span><span class="punctuation">;</span>
<span class="name">desc</span><span class="punctuation">.</span><span class="name">numVertices</span>         <span class="operator">=</span> <span class="operator">&lt;</span><span class="error">頂点数</span><span class="operator">&gt;</span>
<span class="name">desc</span><span class="punctuation">.</span><span class="name">numFaces</span>            <span class="operator">=</span> <span class="operator">&lt;</span><span class="error">面数</span><span class="operator">&gt;</span>
<span class="name">desc</span><span class="punctuation">.</span><span class="name">numVertsPerFace</span>     <span class="operator">=</span> <span class="operator">&lt;</span><span class="error">各面の頂点数配列</span><span class="operator">&gt;</span>
<span class="name">desc</span><span class="punctuation">.</span><span class="name">vertIndicesPerFace</span>  <span class="operator">=</span> <span class="operator">&lt;</span><span class="error">頂点インデックス配列</span><span class="operator">&gt;</span>

<span class="name">Far</span><span class="operator">::</span><span class="name">TopologyRefiner</span> <span class="operator">*</span> <span class="name">refiner</span> <span class="operator">=</span> <span class="name">Far</span><span class="operator">::</span><span class="name">TopologyRefinerFactory</span><span class="operator">&lt;</span><span class="name">Descriptor</span><span class="operator">&gt;::</span><span class="name">Create</span><span class="punctuation">(</span><span class="name">desc</span><span class="punctuation">);</span>
</pre>
<ol class="arabic simple" start="3">
<li>RefineUniform() を呼び出しトポロジを 'maxlevel' まで分割します。</li>
</ol>
<pre class="code c++ literal-block">
<span class="name">refiner</span><span class="operator">-&gt;</span><span class="name">RefineUniform</span><span class="punctuation">(</span><span class="name">Far</span><span class="operator">::</span><span class="name">TopologyRefiner</span><span class="operator">::</span><span class="name">UniformOptions</span><span class="punctuation">(</span><span class="name">maxlevel</span><span class="punctuation">));</span>
</pre>
<ol class="arabic simple" start="4">
<li>レベル 'level' の頂点データを
<a class="reference external" href="far_overview.html#far-primvarrefiner">Far::PrimvarRefiner</a> を使って補間します。</li>
</ol>
<pre class="code c++ literal-block">
<span class="name">Far</span><span class="operator">::</span><span class="name">PrimvarRefiner</span> <span class="name">primvarRefiner</span><span class="punctuation">(</span><span class="operator">*</span><span class="name">refiner</span><span class="punctuation">);</span>

<span class="name">Vertex</span> <span class="keyword">const</span> <span class="operator">*</span><span class="name">src</span> <span class="operator">=</span> <span class="operator">&lt;</span><span class="name">coarse</span> <span class="name">vertices</span><span class="operator">&gt;</span>
<span class="name">Vertex</span> <span class="operator">*</span><span class="name">dst</span>       <span class="operator">=</span> <span class="operator">&lt;</span><span class="name">refined</span> <span class="name">vertices</span><span class="operator">&gt;</span>

<span class="name">primvarRefiner</span><span class="punctuation">.</span><span class="name">Interpolate</span><span class="punctuation">(</span><span class="name">level</span><span class="punctuation">,</span> <span class="name">src</span><span class="punctuation">,</span> <span class="name">dst</span><span class="punctuation">);</span>
</pre>
<ol class="arabic simple" start="5">
<li>分割したレベルでのトポロジは Far::TopologyLevel から取得できます。</li>
</ol>
<pre class="code c++ literal-block">
<span class="name">Far</span><span class="operator">::</span><span class="name">TopologyLevel</span> <span class="keyword">const</span> <span class="operator">&amp;</span> <span class="name">refLastLevel</span> <span class="operator">=</span> <span class="name">refiner</span><span class="operator">-&gt;</span><span class="name">GetLevel</span><span class="punctuation">(</span><span class="name">maxlevel</span><span class="punctuation">);</span>

<span class="keyword type">int</span> <span class="name">nverts</span> <span class="operator">=</span> <span class="name">refLastLevel</span><span class="punctuation">.</span><span class="name">GetNumVertices</span><span class="punctuation">();</span>
<span class="keyword type">int</span> <span class="name">nfaces</span> <span class="operator">=</span> <span class="name">refLastLevel</span><span class="punctuation">.</span><span class="name">GetNumFaces</span><span class="punctuation">();</span>

<span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">face</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">face</span> <span class="operator">&lt;</span> <span class="name">nfaces</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">face</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="name">Far</span><span class="operator">::</span><span class="name">ConstIndexArray</span> <span class="name">fverts</span> <span class="operator">=</span> <span class="name">refLastLevel</span><span class="punctuation">.</span><span class="name">GetFaceVertices</span><span class="punctuation">(</span><span class="name">face</span><span class="punctuation">);</span>

    <span class="comment single">// do something with dst and fverts
</span><span class="punctuation">}</span>
</pre>
<ol class="arabic simple" start="6">
<li>以上で終わりです、詳しくは <a class="reference external" href="far_tutorial_0.html">far_tutorial_0</a> を参照してください。</li>
</ol>
</div>
<div class="section" id="gl">
<h3>利用例２：GLでアニメーションするメッシュを適応型テセレーションで描画</h3>
<p>次の例はOpenSubdiv を使って適応テセレーションパッチをGLで描画する例です。Osd レイヤーを使えば
GLと様々なAPIとの間のやりとりを楽に行えます。またトポロジ一定でアニメーションするメッシュを
効率的に分割するために、ステンシルテーブルを用いて時間変化する頂点の分割を行っています。</p>
<p>以下の例では Osd::GLMesh ユーティリティクラスを使っています。GLMesh は Osd レイヤーの
ステンシルテーブル、パッチテーブル、頂点バッファおよびエバリュエータなどをまとめたクラスです。
これらのクラスをそれぞれ独立に利用することもできます。</p>
<img alt="images/usecase2.png" class="align-center" src="images/usecase2.png" />
<p>1. 利用例１と同様に、<a class="reference external" href="far_overview.html#far-topologyrefiner">Far::TopologyRefiner</a> を
<a class="reference external" href="far_overview.html#far-topologyrefinerfactory">Far::TopologyDescriptor</a> から作成します。</p>
<ol class="arabic simple" start="2">
<li>Osd::Mesh を準備します。この例ではエンドキャップに B スプラインを使っています。</li>
</ol>
<pre class="code c++ literal-block">
<span class="keyword type">int</span> <span class="name">numVertexElements</span> <span class="operator">=</span> <span class="literal number integer">3</span><span class="punctuation">;</span> <span class="comment single">// x, y, z
</span>
<span class="name">Osd</span><span class="operator">::</span><span class="name">MeshBitset</span> <span class="name">bits</span><span class="punctuation">;</span>
<span class="name">bits</span><span class="punctuation">.</span><span class="name">set</span><span class="punctuation">(</span><span class="name">Osd</span><span class="operator">::</span><span class="name">MeshAdaptive</span><span class="punctuation">,</span> <span class="name builtin">true</span><span class="punctuation">);</span>           <span class="comment single">// set adaptive
</span><span class="name">bits</span><span class="punctuation">.</span><span class="name">set</span><span class="punctuation">(</span><span class="name">Osd</span><span class="operator">::</span><span class="name">MeshEndCapBSplineBasis</span><span class="punctuation">,</span> <span class="name builtin">true</span><span class="punctuation">);</span> <span class="comment single">// use b-spline basis patch for endcap.
</span>
<span class="name">Osd</span><span class="operator">::</span><span class="name">GLMeshInterface</span> <span class="operator">*</span><span class="name">mesh</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Osd</span><span class="operator">::</span><span class="name">Mesh</span><span class="operator">&lt;</span><span class="name">Osd</span><span class="operator">::</span><span class="name">CpuGLVertexBuffer</span><span class="punctuation">,</span> <span class="name">Far</span><span class="operator">::</span><span class="name">StencilTable</span><span class="punctuation">,</span>
                                           <span class="name">Osd</span><span class="operator">::</span><span class="name">CpuEvaluator</span><span class="punctuation">,</span> <span class="name">Osd</span><span class="operator">::</span><span class="name">GLPatchTable</span><span class="operator">&gt;</span>
                                    <span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">numVertexElements</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">level</span><span class="punctuation">,</span> <span class="name">bits</span><span class="punctuation">);</span>
</pre>
<p>3. コントロール頂点を更新し、分割します (Osd::Mesh::Refine() は内部で
<a class="reference external" href="osd_overview.html#refinement">Osd::CpuEvaluator::EvalStencils()</a> を呼んでいます)</p>
<pre class="code c++ literal-block">
<span class="name">mesh</span><span class="operator">-&gt;</span><span class="name">UpdateVertexBuffer</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">vertex</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">nverts</span><span class="punctuation">);</span>
<span class="name">mesh</span><span class="operator">-&gt;</span><span class="name">Refine</span><span class="punctuation">();</span>
</pre>
<ol class="arabic simple" start="4">
<li>インデックスバッファ、パッチパラメータバッファ、頂点バッファをバインドします。</li>
</ol>
<pre class="code c++ literal-block">
<span class="comment single">// インデックスバッファ
</span><span class="name">glBindBuffer</span><span class="punctuation">(</span><span class="name">GL_ELEMENT_ARRAY_BUFFER</span><span class="punctuation">,</span> <span class="name">mesh</span><span class="operator">-&gt;</span><span class="name">GetPatchTable</span><span class="punctuation">()</span><span class="operator">-&gt;</span><span class="name">GetPatchIndexBuffer</span><span class="punctuation">());</span>

<span class="comment single">// 頂点バッファ
</span><span class="name">glBindBuffer</span><span class="punctuation">(</span><span class="name">GL_ARRAY_BUFFER</span><span class="punctuation">,</span> <span class="name">mesh</span><span class="operator">-&gt;</span><span class="name">BindVertexBuffer</span><span class="punctuation">());</span>
<span class="name">glEnableVertexAttribArray</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">);</span>
<span class="name">glVertexAttribPointer</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">numVertexElements</span><span class="punctuation">,</span> <span class="name">GL_FLOAT</span><span class="punctuation">,</span> <span class="name">GL_FALSE</span><span class="punctuation">,</span>
                      <span class="name">numVertexElements</span><span class="operator">*</span><span class="keyword">sizeof</span><span class="punctuation">(</span><span class="keyword type">float</span><span class="punctuation">),</span> <span class="literal number integer">0</span><span class="punctuation">);</span>

<span class="comment single">// パッチパラメータバッファ
</span><span class="name">glActiveTexture</span><span class="punctuation">(</span><span class="name">GL_TEXTURE0</span><span class="punctuation">);</span>
<span class="name">glBindTexture</span><span class="punctuation">(</span><span class="name">GL_TEXTURE_BUFFER</span><span class="punctuation">,</span> <span class="name">mesh</span><span class="operator">-&gt;</span><span class="name">GetPatchTable</span><span class="punctuation">()</span><span class="operator">-&gt;</span><span class="name">GetPatchParamTextureBuffer</span><span class="punctuation">());</span>
</pre>
<p>5. 描画します。この例では Bスプラインのエンドキャップを使っているため、パッチテーブルにはパッチ配列がひとつしかありません。
もし他のエンドキャップを使った場合にはパッチ配列でループする必要があります。それぞれのパッチタイプでの
GLSLプログラムの構成方法は <a class="reference external" href="osd_shader_interface.html">osd shader interface</a> をご覧ください。</p>
<pre class="code c++ literal-block">
<span class="name">Osd</span><span class="operator">::</span><span class="name">PatchArray</span> <span class="keyword">const</span> <span class="operator">&amp;</span> <span class="name">patch</span> <span class="operator">=</span> <span class="name">mesh</span><span class="operator">-&gt;</span><span class="name">GetPatchTable</span><span class="punctuation">()</span><span class="operator">-&gt;</span><span class="name">GetPatchArrays</span><span class="punctuation">()[</span><span class="literal number integer">0</span><span class="punctuation">];</span>
<span class="name">Far</span><span class="operator">::</span><span class="name">PatchDescriptor</span> <span class="name">desc</span> <span class="operator">=</span> <span class="name">patch</span><span class="punctuation">.</span><span class="name">GetDescriptor</span><span class="punctuation">();</span>

<span class="keyword type">int</span> <span class="name">numVertsPerPatch</span> <span class="operator">=</span> <span class="name">desc</span><span class="punctuation">.</span><span class="name">GetNumControlVertices</span><span class="punctuation">();</span>  <span class="comment single">// 16 for B-spline patches
</span><span class="name">glUseProgram</span><span class="punctuation">(</span><span class="name">BSplinePatchProgram</span><span class="punctuation">);</span>
<span class="name">glPatchParameteri</span><span class="punctuation">(</span><span class="name">GL_PATCH_VERTICES</span><span class="punctuation">,</span> <span class="name">numVertsPerPatch</span><span class="punctuation">);</span>
<span class="name">glDrawElements</span><span class="punctuation">(</span><span class="name">GL_PATCHES</span><span class="punctuation">,</span> <span class="name">patch</span><span class="punctuation">.</span><span class="name">GetNumPatches</span><span class="punctuation">()</span> <span class="operator">*</span> <span class="name">numVertsPerPatch</span><span class="punctuation">,</span>
               <span class="name">GL_UNSIGNED_INT</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">);</span>
</pre>
<p>6. メッシュのアニメーションに応じて、ステップ３から繰り返します（頂点の更新、分割、描画）。
<a class="reference external" href="glviewer.html">glViewer</a> および他のサンプルプログラムも参照してください。</p>
</div>
<div class="section" id="id5">
<h3>チュートリアルと例</h3>
<p>より詳しい使い方は <a class="reference external" href="tutorials.html">Tutorials</a> と <a class="reference external" href="code_examples.html">Examples</a> にもあります。</p>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2015-06-24 20:59 UTC.

</div>
</body>
</html>

          </div><!-- close topicLeftData-MainData -->
        </div><!-- close coursewareBackground -->
    </div> <!-- close mainContentContainer -->
</div> <!-- close center -->

<div class="clearBoth"></div>


<div class="center">

    <div class="copyrightFooter">
    </div>


<!-- BOTTOM NAVIGATION MENU -->
    <ul class="creatorFooterNav">
        <li class="" id="navbarId-23704">
            <a href="intro.html">User Docs</a>
        </li>
        <li class="" id="navbarId-23887">
            <a href="doxy_html/index.html">API Docs</a>
        </li>
        <li class="" id="navbarId-23944">
            <a href="release_notes.html">Release Notes</a>
        </li>
        <li class="" id="navbarId-23703">
            <a href="http://graphics.pixar.com/opensubdiv/forum.html">Forum</a>
        </li>
    </ul><!-- end bottom navigation menu -->

<div class="clearBoth"></div>
