<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>far_tutorial_1.cpp</title>
<link rel="icon" type="image/png" href="images/icon.png">
<link rel="stylesheet" href="css/rst.css" type="text/css" />
<link rel="stylesheet" href="css/default.css" type="text/css" />
<link rel="stylesheet" href="css/flavor.css" type="text/css" />
<link rel="stylesheet" href="css/renderman-university.css" type="text/css" />
<link rel="stylesheet" href="css/pygments.css" type="text/css" />
<style>
#mainContentContainer {
    left: 15px;
    margin-left: 255px;
}
ul.creatorFooterNav {
    margin-left: 100px;
}
.navigation {
    background-color: #333333;
    margin-top: 10px;
    margin-left: 10px;
}
ul.creatorMainNav li a {
    font-size: 12px !important;
}
</style>
</head>
<body>

<div class="navigation">
    <br>
    <div class="searchBar">
        <form action="search.html">
            <input type="text" name="q" id="searchInput" />
            <input type="button" id="searchButton" onclick="this.form.submit();" value="Search" />
        </form>
    </div>
    <div class="quickLinks">
        <ul>
            <li><a href="intro.html">はじめに</a></li>
                <ul>
                    <li><a href="license.html">ライセンス (en)</a></li>
                    <li><a href="getting_started.html">始めよう (en)</a></li>
                    <li><a href="contributing.html">参加しよう (en)</a></li>
                    <li><a href="cmake_build.html">ビルド方法 (en)</a></li>
                    <li><a href="code_examples.html">コード例 (en)</a></li>
                    <li><a href="roadmap.html">ロードマップ (en)</a></li>
                </ul>
            <p></p>
            <li><a href="intro_30.html">リリース 3.0</a></li>
                <ul>
                    <li><a href="intro_30.html">概要</a></li>
                    <li><a href="porting.html">2.0から3.0への移植ガイド (en)</a></li>
                    <li><a href="compatibility.html">サブディビジョンの互換性 (en)</a></li>
                </ul>
            <p></p>
            <li><a href="subdivision_surfaces.html">サブディビジョンサーフェス</a>
                <ul>
                    <li><a href="subdivision_surfaces.html#introduction">はじめに</a></li>
                    <li><a href="subdivision_surfaces.html#arbitrary-topology">トポロジ</a></li>
                    <li><a href="subdivision_surfaces.html#uniform-subdivision">均一分割</a></li>
                    <li><a href="subdivision_surfaces.html#feature-adaptive-subdivision">適応分割</a></li>
                    <li><a href="subdivision_surfaces.html#boundary-interpolation-rules">境界補間則</a></li>
                    <li><a href="subdivision_surfaces.html#face-varying-interpolation-rules">面変化境界補間則</a></li>
                    <li><a href="subdivision_surfaces.html#semi-sharp-creases">セミシャープクリース</a></li>
                    <li><a href="mod_notes.html">モデリングのコツ (en)</a></li>
                </ul>
            </li>
            <p></p>
            <li><a href="api_overview.html">OpenSubdiv ユーザーガイド</a>
                <ul>
                    <li><a href="api_overview.html">API概要</a>
                        <li><a href="sdc_overview.html">Sdc (en)</a></li>
                        <li><a href="vtr_overview.html">Vtr (en)</a></li>
                        <li><a href="far_overview.html">Far (en)</a></li>
                        <ul>
                            <li><a href="far_overview.html#far-topologyrefiner">Topology Refiner (en)</a></li>
                            <li><a href="far_overview.html#far-topologyrefinerfactory">Topology Refiner Factory (en)</a></li>
                            <li><a href="far_overview.html#far-primvarrefiner">Primvar Refiner (en)</a></li>
                            <li><a href="far_overview.html#far-patchtable">Patch Table (en)</a></li>
                            <li><a href="far_overview.html#far-stenciltable">Stencil Table v</a></li>
                        </ul>
                        <li><a href="osd_overview.html">Osd (en)</a></li>
                        <ul>
                            <li><a href="osd_shader_interface.html">シェーダインタフェース (en)</a></li>
                        </ul>
                    </li>
                    <p></p>
                    <li><a href="tutorials.html">チュートリアル (en)</a>
                    <p></p>
                    <li><a href="hbr_overview.html">過去の情報 (en)</a></li>
                    <ul>
                        <li><a href="hbr_overview.html">Hbr (en)</a></li>
                        <ul>
                            <li><a href="using_osd_hbr.html">Using Hbr (en)</a></li>
                        </ul>
                        <li><a href="hedits.html">階層エディット (en)</a></li>
                    </ul>
                </ul>
            </li>
            <p></p>
            <li><a href="additional_resources.html">追加情報 (en)</a>
                <ul>
                    <li><a href="http://graphics.pixar.com/opensubdiv/forum.html">フォーラム</a>
                    <li><a href="additional_resources.html#links">リンク</a>
                    <li><a href="additional_resources.html#videos">ビデオ</a>
                </ul>
            <p></p>
            <li><a href="release_notes.html">リリースノート</a>
            <p></p>
            <li><a href="doxy_html/index.html" target="_blank">Doxygen</a></li>
        </ul>
    </div>
    <br>
</div>

<div class="document" id="far-tutorial-1-cpp">
<h1 class="title">far_tutorial_1.cpp</h1>


    <div id="mainContentContainer">
        <div class="fullWidth headerColor">
            <div class="center">
                <div id="mainSiteNavigation">
                    <div class="homeRenderManLink">
                        <a href="http://graphics.pixar.com/opensubdiv/index.html"><img alt="OpenSubdiv Logo" src="images/opensubdiv_logo_header.png"></a>
                    </div>
          
					<!-- TOP NAVIGATION MENU -->
                    <ul class="creatorMainNav floatLeft" id="menu">
                        <li class="creatorMainNav">
                            <a href="release_notes.html">3.0.0</a>
                        </li>
                    </ul>
                    <ul class="creatorMainNav floatNav" id="menu">
                        <li class="mainSubNavigation marginR12 marginL12" id="navbarId-23704">
                            <a href="intro.html">User Docs</a>
                        </li>
                        <li class="mainSubNavigation marginR12 marginL12" id="navbarId-23887">
                            <a href="doxy_html/index.html">API Docs</a>
                        </li>
                        <li class="mainSubNavigation marginR12 marginL12" id="navbarId-23944">
                            <a href="release_notes.html">Release Notes</a>
                        </li>
                        <li class="mainSubNavigation marginR15 marginL12" id="navbarId-23703">
                            <a href="http://graphics.pixar.com/opensubdiv/forum.html">Forum</a>
                        </li>
                        <a class="blueButton marginR0 marginL0" style="width:70px" href="https://github.com/PixarAnimationStudios/OpenSubdiv">Github</a>
                    </ul>
                </div><!-- close mainSiteNavigation -->
            </div><!-- close center -->
        </div><!-- close fullWidth -->


        <div class="clearBoth"></div>
        
        <h1 class="articleContentTitle">far_tutorial_1.cpp</h1>
        
        <div class="clearBoth"></div>
        
        <hr>
        
        <div class="clearBoth"></div>
        
        <div class="coursewareBackground">

          <!-- <div class="topicLeftData-IntroPara"></div> -->
          <div class="topicLeftData-MainData">
<p><a class="reference external" href="https://github.com/PixarAnimationStudios/OpenSubdiv/blob/master/tutorials/far/tutorial_1/far_tutorial_1.cpp">https://github.com/PixarAnimationStudios/OpenSubdiv/blob/master/tutorials/far/tutorial_1/far_tutorial_1.cpp</a></p>
<hr class="docutils" />
<pre class="code c literal-block">
<span class="comment single">//------------------------------------------------------------------------------
// Tutorial description:
//
// This tutorial shows how to interface a high-level topology representation
// with Far for better efficiency. In tutorial 0, we showed how to instantiate
// topology from a simple face-vertex list. Here we will show how to take
// advantage of more complex data structures.
//
// Many client applications that manipulate geometry use advanced data structures
// such as half-edge, quad-edge or winged-edge in order to represent complex
// topological relationships beyond the usual face-vertex lists. We can take
// advantage of this information.
//
// Far provides an advanced interface that allows such a client application to
// communicate advanced component relationships directly and avoid having Far
// rebuilding them redundantly.
//
</span>
<span class="comment preproc">#include &lt;opensubdiv/far/topologyRefinerFactory.h&gt;
#include &lt;opensubdiv/far/primvarRefiner.h&gt;
</span>
<span class="comment preproc">#include &lt;cstdio&gt;
</span>
<span class="comment single">//------------------------------------------------------------------------------
</span>
<span class="name">using</span> <span class="name">namespace</span> <span class="name">OpenSubdiv</span><span class="punctuation">;</span>

<span class="comment single">//------------------------------------------------------------------------------
//
// For this tutorial, we provide the complete topological representation of a
// simple pyramid. In our case, we store it as a simple sequence of integers,
// with the understanding that client-code would provide a fully implemented
// data-structure such as quad-edges or winged-edges.
//
// Pyramid geometry from catmark_pyramid.h - extended for this tutorial
//
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_nverts</span> <span class="operator">=</span> <span class="literal number integer">5</span><span class="punctuation">,</span>
           <span class="name">g_nedges</span> <span class="operator">=</span> <span class="literal number integer">8</span><span class="punctuation">,</span>
           <span class="name">g_nfaces</span> <span class="operator">=</span> <span class="literal number integer">5</span><span class="punctuation">;</span>

<span class="comment single">// vertex positions
</span><span class="keyword">static</span> <span class="keyword type">float</span> <span class="name">g_verts</span><span class="punctuation">[</span><span class="literal number integer">5</span><span class="punctuation">][</span><span class="literal number integer">3</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{{</span> <span class="literal number float">0.0f</span><span class="punctuation">,</span>  <span class="literal number float">0.0f</span><span class="punctuation">,</span>  <span class="literal number float">2.0f</span><span class="punctuation">},</span>
                              <span class="punctuation">{</span> <span class="literal number float">0.0f</span><span class="punctuation">,</span> <span class="operator">-</span><span class="literal number float">2.0f</span><span class="punctuation">,</span>  <span class="literal number float">0.0f</span><span class="punctuation">},</span>
                              <span class="punctuation">{</span> <span class="literal number float">2.0f</span><span class="punctuation">,</span>  <span class="literal number float">0.0f</span><span class="punctuation">,</span>  <span class="literal number float">0.0f</span><span class="punctuation">},</span>
                              <span class="punctuation">{</span> <span class="literal number float">0.0f</span><span class="punctuation">,</span>  <span class="literal number float">2.0f</span><span class="punctuation">,</span>  <span class="literal number float">0.0f</span><span class="punctuation">},</span>
                              <span class="punctuation">{</span><span class="operator">-</span><span class="literal number float">2.0f</span><span class="punctuation">,</span>  <span class="literal number float">0.0f</span><span class="punctuation">,</span>  <span class="literal number float">0.0f</span><span class="punctuation">}};</span>

<span class="comment single">// number of vertices in each face
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_facenverts</span><span class="punctuation">[</span><span class="literal number integer">5</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">4</span> <span class="punctuation">};</span>

<span class="comment single">// index of face vertices
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_faceverts</span><span class="punctuation">[</span><span class="literal number integer">16</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
                               <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span>
                               <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span>
                               <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span>
                               <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">1</span> <span class="punctuation">};</span>

<span class="comment single">// index of edge vertices (2 per edge)
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_edgeverts</span><span class="punctuation">[</span><span class="literal number integer">16</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span>
                               <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
                               <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">,</span>
                               <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span>
                               <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">,</span>
                               <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span>
                               <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">,</span>
                               <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">1</span> <span class="punctuation">};</span>


<span class="comment single">// index of face edges
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_faceedges</span><span class="punctuation">[</span><span class="literal number integer">16</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
                               <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span>
                               <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">5</span><span class="punctuation">,</span> <span class="literal number integer">6</span><span class="punctuation">,</span>
                               <span class="literal number integer">6</span><span class="punctuation">,</span> <span class="literal number integer">7</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">,</span>
                               <span class="literal number integer">5</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">7</span> <span class="punctuation">};</span>

<span class="comment single">// number of faces adjacent to each edge
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_edgenfaces</span><span class="punctuation">[</span><span class="literal number integer">8</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span> <span class="punctuation">};</span>

<span class="comment single">// index of faces incident to a given edge
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_edgefaces</span><span class="punctuation">[</span><span class="literal number integer">16</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span>
                               <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span>
                               <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span>
                               <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span>
                               <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
                               <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span>
                               <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span>
                               <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">4</span> <span class="punctuation">};</span>

<span class="comment single">// number of faces incident to each vertex
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_vertexnfaces</span><span class="punctuation">[</span><span class="literal number integer">5</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span> <span class="punctuation">};</span>

<span class="comment single">// index of faces incident to each vertex
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_vertexfaces</span><span class="punctuation">[</span><span class="literal number integer">25</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span>
                                 <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span>
                                 <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span>
                                 <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
                                 <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">3</span> <span class="punctuation">};</span>


<span class="comment single">// number of edges incident to each vertex
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_vertexnedges</span><span class="punctuation">[</span><span class="literal number integer">5</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span> <span class="punctuation">};</span>

<span class="comment single">// index of edges incident to each vertex
</span><span class="keyword">static</span> <span class="keyword type">int</span> <span class="name">g_vertexedges</span><span class="punctuation">[</span><span class="literal number integer">25</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">6</span><span class="punctuation">,</span>
                                 <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">7</span><span class="punctuation">,</span>
                                 <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span>
                                 <span class="literal number integer">4</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">5</span><span class="punctuation">,</span>
                                 <span class="literal number integer">6</span><span class="punctuation">,</span> <span class="literal number integer">5</span><span class="punctuation">,</span> <span class="literal number integer">7</span> <span class="punctuation">};</span>

<span class="comment single">// Edge crease sharpness
</span><span class="keyword">static</span> <span class="keyword type">float</span> <span class="name">g_edgeCreases</span><span class="punctuation">[</span><span class="literal number integer">8</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="literal number float">0.0f</span><span class="punctuation">,</span>
                                  <span class="literal number float">2.5f</span><span class="punctuation">,</span>
                                  <span class="literal number float">0.0f</span><span class="punctuation">,</span>
                                  <span class="literal number float">2.5f</span><span class="punctuation">,</span>
                                  <span class="literal number float">0.0f</span><span class="punctuation">,</span>
                                  <span class="literal number float">2.5f</span><span class="punctuation">,</span>
                                  <span class="literal number float">0.0f</span><span class="punctuation">,</span>
                                  <span class="literal number float">2.5f</span> <span class="punctuation">};</span>

<span class="comment single">//------------------------------------------------------------------------------
//
// Because existing client-code may not provide an exact match for the
// topological queries required by Far's interface, we can provide a converter
// class. This can be particularly useful for instance if the client
// data-structure requires additional relationships to be mapped. For instance,
// half-edge representations do not store unique edge indices and it can be
// difficult to traverse edges or faces adjacent to a given vertex.
//
// Using an intermediate wrapper class allows us to leverage existing
// relationships information from a mesh, and generate the missing components
// temporarily.
//
// For a practical example, you can look at the file 'hbr_to_vtr.h' in the same
// tutorial directory. This example implements a 'OsdHbrConverter' class as a
// way of interfacing PRman's half-edge representation to Far.
//
</span><span class="keyword">struct</span> <span class="name">Converter</span> <span class="punctuation">{</span>

<span class="name label">public</span><span class="punctuation">:</span>

    <span class="name">Sdc</span><span class="operator">::</span><span class="name">SchemeType</span> <span class="name">GetType</span><span class="punctuation">()</span> <span class="keyword">const</span> <span class="punctuation">{</span>
        <span class="keyword">return</span> <span class="name">Sdc</span><span class="operator">::</span><span class="name">SCHEME_CATMARK</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>

    <span class="name">Sdc</span><span class="operator">::</span><span class="name">Options</span> <span class="name">GetOptions</span><span class="punctuation">()</span> <span class="keyword">const</span> <span class="punctuation">{</span>
        <span class="name">Sdc</span><span class="operator">::</span><span class="name">Options</span> <span class="name">options</span><span class="punctuation">;</span>
        <span class="name">options</span><span class="punctuation">.</span><span class="name">SetVtxBoundaryInterpolation</span><span class="punctuation">(</span><span class="name">Sdc</span><span class="operator">::</span><span class="name">Options</span><span class="operator">::</span><span class="name">VTX_BOUNDARY_EDGE_ONLY</span><span class="punctuation">);</span>
        <span class="keyword">return</span> <span class="name">options</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="name">GetNumFaces</span><span class="punctuation">()</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_nfaces</span><span class="punctuation">;</span> <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="name">GetNumEdges</span><span class="punctuation">()</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_nedges</span><span class="punctuation">;</span> <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="name">GetNumVertices</span><span class="punctuation">()</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_nverts</span><span class="punctuation">;</span> <span class="punctuation">}</span>

    <span class="comment single">//
</span>    <span class="comment single">// Face relationships
</span>    <span class="comment single">//
</span>    <span class="keyword type">int</span> <span class="name">GetNumFaceVerts</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">face</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_facenverts</span><span class="punctuation">[</span><span class="name">face</span><span class="punctuation">];</span> <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">GetFaceVerts</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">face</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_faceverts</span><span class="operator">+</span><span class="name">getCompOffset</span><span class="punctuation">(</span><span class="name">g_facenverts</span><span class="punctuation">,</span> <span class="name">face</span><span class="punctuation">);</span> <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">GetFaceEdges</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">edge</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_faceedges</span><span class="operator">+</span><span class="name">getCompOffset</span><span class="punctuation">(</span><span class="name">g_facenverts</span><span class="punctuation">,</span> <span class="name">edge</span><span class="punctuation">);</span> <span class="punctuation">}</span>


    <span class="comment single">//
</span>    <span class="comment single">// Edge relationships
</span>    <span class="comment single">//
</span>    <span class="keyword type">int</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">GetEdgeVertices</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">edge</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_edgeverts</span><span class="operator">+</span><span class="name">edge</span><span class="operator">*</span><span class="literal number integer">2</span><span class="punctuation">;</span> <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="name">GetNumEdgeFaces</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">edge</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_edgenfaces</span><span class="punctuation">[</span><span class="name">edge</span><span class="punctuation">];</span> <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">GetEdgeFaces</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">edge</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_edgefaces</span><span class="operator">+</span><span class="name">getCompOffset</span><span class="punctuation">(</span><span class="name">g_edgenfaces</span><span class="punctuation">,</span> <span class="name">edge</span><span class="punctuation">);</span> <span class="punctuation">}</span>

    <span class="comment single">//
</span>    <span class="comment single">// Vertex relationships
</span>    <span class="comment single">//
</span>    <span class="keyword type">int</span> <span class="name">GetNumVertexEdges</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">vert</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_vertexnedges</span><span class="punctuation">[</span><span class="name">vert</span><span class="punctuation">];</span> <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">GetVertexEdges</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">vert</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_vertexedges</span><span class="operator">+</span><span class="name">getCompOffset</span><span class="punctuation">(</span><span class="name">g_vertexnedges</span><span class="punctuation">,</span> <span class="name">vert</span><span class="punctuation">);</span> <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="name">GetNumVertexFaces</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">vert</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_vertexnfaces</span><span class="punctuation">[</span><span class="name">vert</span><span class="punctuation">];</span> <span class="punctuation">}</span>

    <span class="keyword type">int</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">GetVertexFaces</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">vert</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span> <span class="keyword">return</span> <span class="name">g_vertexfaces</span><span class="operator">+</span><span class="name">getCompOffset</span><span class="punctuation">(</span><span class="name">g_vertexnfaces</span><span class="punctuation">,</span> <span class="name">vert</span><span class="punctuation">);</span> <span class="punctuation">}</span>

<span class="name label">private</span><span class="punctuation">:</span>

    <span class="keyword type">int</span> <span class="name">getCompOffset</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">comps</span><span class="punctuation">,</span> <span class="keyword type">int</span> <span class="name">comp</span><span class="punctuation">)</span> <span class="keyword">const</span> <span class="punctuation">{</span>
        <span class="keyword type">int</span> <span class="name">ofs</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span>
        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">i</span><span class="operator">&lt;</span><span class="name">comp</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">i</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="name">ofs</span> <span class="operator">+=</span> <span class="name">comps</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">];</span>
        <span class="punctuation">}</span>
        <span class="keyword">return</span> <span class="name">ofs</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>

<span class="punctuation">};</span>

<span class="comment single">//------------------------------------------------------------------------------
</span>
<span class="name">namespace</span> <span class="name">OpenSubdiv</span> <span class="punctuation">{</span>
<span class="name">namespace</span> <span class="name">OPENSUBDIV_VERSION</span> <span class="punctuation">{</span>

<span class="name">namespace</span> <span class="name">Far</span> <span class="punctuation">{</span>

<span class="name">template</span> <span class="operator">&lt;&gt;</span>
<span class="keyword type">bool</span>
<span class="name">TopologyRefinerFactory</span><span class="operator">&lt;</span><span class="name">Converter</span><span class="operator">&gt;::</span><span class="name">resizeComponentTopology</span><span class="punctuation">(</span>
    <span class="name">TopologyRefiner</span> <span class="operator">&amp;</span> <span class="name">refiner</span><span class="punctuation">,</span> <span class="name">Converter</span> <span class="keyword">const</span> <span class="operator">&amp;</span> <span class="name">conv</span><span class="punctuation">)</span> <span class="punctuation">{</span>

    <span class="comment single">// Faces and face-verts
</span>    <span class="keyword type">int</span> <span class="name">nfaces</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumFaces</span><span class="punctuation">();</span>
    <span class="name">setNumBaseFaces</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">nfaces</span><span class="punctuation">);</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">face</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">face</span><span class="operator">&lt;</span><span class="name">nfaces</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">face</span><span class="punctuation">)</span> <span class="punctuation">{</span>

        <span class="keyword type">int</span> <span class="name">nv</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumFaceVerts</span><span class="punctuation">(</span><span class="name">face</span><span class="punctuation">);</span>
        <span class="name">setNumBaseFaceVertices</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">face</span><span class="punctuation">,</span> <span class="name">nv</span><span class="punctuation">);</span>
    <span class="punctuation">}</span>

   <span class="comment single">// Edges and edge-faces
</span>    <span class="keyword type">int</span> <span class="name">nedges</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumEdges</span><span class="punctuation">();</span>
    <span class="name">setNumBaseEdges</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">nedges</span><span class="punctuation">);</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">edge</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">edge</span><span class="operator">&lt;</span><span class="name">nedges</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">edge</span><span class="punctuation">)</span> <span class="punctuation">{</span>

        <span class="keyword type">int</span> <span class="name">nf</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumEdgeFaces</span><span class="punctuation">(</span><span class="name">edge</span><span class="punctuation">);</span>
        <span class="name">setNumBaseEdgeFaces</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">edge</span><span class="punctuation">,</span> <span class="name">nf</span><span class="punctuation">);</span>
    <span class="punctuation">}</span>

    <span class="comment single">// Vertices and vert-faces and vert-edges
</span>    <span class="keyword type">int</span> <span class="name">nverts</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumVertices</span><span class="punctuation">();</span>
    <span class="name">setNumBaseVertices</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">nverts</span><span class="punctuation">);</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">vert</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">vert</span><span class="operator">&lt;</span><span class="name">nverts</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">vert</span><span class="punctuation">)</span> <span class="punctuation">{</span>

        <span class="keyword type">int</span> <span class="name">ne</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumVertexEdges</span><span class="punctuation">(</span><span class="name">vert</span><span class="punctuation">),</span>
            <span class="name">nf</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumVertexFaces</span><span class="punctuation">(</span><span class="name">vert</span><span class="punctuation">);</span>
        <span class="name">setNumBaseVertexEdges</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">vert</span><span class="punctuation">,</span> <span class="name">ne</span><span class="punctuation">);</span>
        <span class="name">setNumBaseVertexFaces</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">vert</span><span class="punctuation">,</span> <span class="name">nf</span><span class="punctuation">);</span>
    <span class="punctuation">}</span>
    <span class="keyword">return</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="name">template</span> <span class="operator">&lt;&gt;</span>
<span class="keyword type">bool</span>
<span class="name">TopologyRefinerFactory</span><span class="operator">&lt;</span><span class="name">Converter</span><span class="operator">&gt;::</span><span class="name">assignComponentTopology</span><span class="punctuation">(</span>
    <span class="name">TopologyRefiner</span> <span class="operator">&amp;</span> <span class="name">refiner</span><span class="punctuation">,</span> <span class="name">Converter</span> <span class="keyword">const</span> <span class="operator">&amp;</span> <span class="name">conv</span><span class="punctuation">)</span> <span class="punctuation">{</span>

    <span class="keyword">typedef</span> <span class="name">Far</span><span class="operator">::</span><span class="name">IndexArray</span>      <span class="name">IndexArray</span><span class="punctuation">;</span>

    <span class="punctuation">{</span> <span class="comment single">// Face relations:
</span>        <span class="keyword type">int</span> <span class="name">nfaces</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumFaces</span><span class="punctuation">();</span>
        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">face</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">face</span><span class="operator">&lt;</span><span class="name">nfaces</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">face</span><span class="punctuation">)</span> <span class="punctuation">{</span>

            <span class="name">IndexArray</span> <span class="name">dstFaceVerts</span> <span class="operator">=</span> <span class="name">getBaseFaceVertices</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">face</span><span class="punctuation">);</span>
            <span class="name">IndexArray</span> <span class="name">dstFaceEdges</span> <span class="operator">=</span> <span class="name">getBaseFaceEdges</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">face</span><span class="punctuation">);</span>

            <span class="keyword type">int</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">faceverts</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetFaceVerts</span><span class="punctuation">(</span><span class="name">face</span><span class="punctuation">);</span>
            <span class="keyword type">int</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">faceedges</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetFaceEdges</span><span class="punctuation">(</span><span class="name">face</span><span class="punctuation">);</span>

            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">vert</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">vert</span><span class="operator">&lt;</span><span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumFaceVerts</span><span class="punctuation">(</span><span class="name">face</span><span class="punctuation">);</span> <span class="operator">++</span><span class="name">vert</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="name">dstFaceVerts</span><span class="punctuation">[</span><span class="name">vert</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">faceverts</span><span class="punctuation">[</span><span class="name">vert</span><span class="punctuation">];</span>
                <span class="name">dstFaceEdges</span><span class="punctuation">[</span><span class="name">vert</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">faceedges</span><span class="punctuation">[</span><span class="name">vert</span><span class="punctuation">];</span>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>

    <span class="punctuation">{</span> <span class="comment single">// Edge relations
</span>      <span class="comment single">//
</span>      <span class="comment single">// Note: if your representation is unable to provide edge relationships
</span>      <span class="comment single">//       (ex: half-edges), you can comment out this section and Far will
</span>      <span class="comment single">//       automatically generate the missing information.
</span>      <span class="comment single">//
</span>        <span class="keyword type">int</span> <span class="name">nedges</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumEdges</span><span class="punctuation">();</span>
        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">edge</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">edge</span><span class="operator">&lt;</span><span class="name">nedges</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">edge</span><span class="punctuation">)</span> <span class="punctuation">{</span>

            <span class="comment single">//  Edge-vertices:
</span>            <span class="name">IndexArray</span> <span class="name">dstEdgeVerts</span> <span class="operator">=</span> <span class="name">getBaseEdgeVertices</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">edge</span><span class="punctuation">);</span>
            <span class="name">dstEdgeVerts</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetEdgeVertices</span><span class="punctuation">(</span><span class="name">edge</span><span class="punctuation">)[</span><span class="literal number integer">0</span><span class="punctuation">];</span>
            <span class="name">dstEdgeVerts</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetEdgeVertices</span><span class="punctuation">(</span><span class="name">edge</span><span class="punctuation">)[</span><span class="literal number integer">1</span><span class="punctuation">];</span>

            <span class="comment single">//  Edge-faces
</span>            <span class="name">IndexArray</span> <span class="name">dstEdgeFaces</span> <span class="operator">=</span> <span class="name">getBaseEdgeFaces</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">edge</span><span class="punctuation">);</span>
            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">face</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">face</span><span class="operator">&lt;</span><span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumEdgeFaces</span><span class="punctuation">(</span><span class="name">face</span><span class="punctuation">);</span> <span class="operator">++</span><span class="name">face</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="name">dstEdgeFaces</span><span class="punctuation">[</span><span class="name">face</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetEdgeFaces</span><span class="punctuation">(</span><span class="name">edge</span><span class="punctuation">)[</span><span class="name">face</span><span class="punctuation">];</span>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>

    <span class="punctuation">{</span> <span class="comment single">// Vertex relations
</span>        <span class="keyword type">int</span> <span class="name">nverts</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumVertices</span><span class="punctuation">();</span>
        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">vert</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">vert</span><span class="operator">&lt;</span><span class="name">nverts</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">vert</span><span class="punctuation">)</span> <span class="punctuation">{</span>

            <span class="comment single">//  Vert-Faces:
</span>            <span class="name">IndexArray</span> <span class="name">vertFaces</span> <span class="operator">=</span> <span class="name">getBaseVertexFaces</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">vert</span><span class="punctuation">);</span>
            <span class="comment single">//LocalIndexArray vertInFaceIndices = getBaseVertexFaceLocalIndices(refiner, vert);
</span>            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">face</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">face</span><span class="operator">&lt;</span><span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumVertexFaces</span><span class="punctuation">(</span><span class="name">vert</span><span class="punctuation">);</span> <span class="operator">++</span><span class="name">face</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="name">vertFaces</span><span class="punctuation">[</span><span class="name">face</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetVertexFaces</span><span class="punctuation">(</span><span class="name">vert</span><span class="punctuation">)[</span><span class="name">face</span><span class="punctuation">];</span>
            <span class="punctuation">}</span>

            <span class="comment single">//  Vert-Edges:
</span>            <span class="name">IndexArray</span> <span class="name">vertEdges</span> <span class="operator">=</span> <span class="name">getBaseVertexEdges</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">vert</span><span class="punctuation">);</span>
            <span class="comment single">//LocalIndexArray vertInEdgeIndices = getBaseVertexEdgeLocalIndices(refiner, vert);
</span>            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">edge</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">edge</span><span class="operator">&lt;</span><span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumVertexEdges</span><span class="punctuation">(</span><span class="name">vert</span><span class="punctuation">);</span> <span class="operator">++</span><span class="name">edge</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="name">vertEdges</span><span class="punctuation">[</span><span class="name">edge</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetVertexEdges</span><span class="punctuation">(</span><span class="name">vert</span><span class="punctuation">)[</span><span class="name">edge</span><span class="punctuation">];</span>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>

    <span class="name">populateBaseLocalIndices</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">);</span>

    <span class="keyword">return</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="punctuation">};</span>

<span class="name">template</span> <span class="operator">&lt;&gt;</span>
<span class="keyword type">bool</span>
<span class="name">TopologyRefinerFactory</span><span class="operator">&lt;</span><span class="name">Converter</span><span class="operator">&gt;::</span><span class="name">assignComponentTags</span><span class="punctuation">(</span>
    <span class="name">TopologyRefiner</span> <span class="operator">&amp;</span> <span class="name">refiner</span><span class="punctuation">,</span> <span class="name">Converter</span> <span class="keyword">const</span> <span class="operator">&amp;</span> <span class="name">conv</span><span class="punctuation">)</span> <span class="punctuation">{</span>

    <span class="comment single">// arbitrarily sharpen the 4 bottom edges of the pyramid to 2.5f
</span>    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">edge</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">edge</span><span class="operator">&lt;</span><span class="name">conv</span><span class="punctuation">.</span><span class="name">GetNumEdges</span><span class="punctuation">();</span> <span class="operator">++</span><span class="name">edge</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="name">setBaseEdgeSharpness</span><span class="punctuation">(</span><span class="name">refiner</span><span class="punctuation">,</span> <span class="name">edge</span><span class="punctuation">,</span> <span class="name">g_edgeCreases</span><span class="punctuation">[</span><span class="name">edge</span><span class="punctuation">]);</span>
    <span class="punctuation">}</span>
    <span class="keyword">return</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="comment preproc">#ifdef _MSC_VER
</span><span class="name">template</span> <span class="operator">&lt;&gt;</span>
<span class="keyword type">void</span>
<span class="name">TopologyRefinerFactory</span><span class="operator">&lt;</span><span class="name">Converter</span><span class="operator">&gt;::</span><span class="name">reportInvalidTopology</span><span class="punctuation">(</span>
    <span class="name">TopologyError</span> <span class="comment multiline">/* errCode */</span><span class="punctuation">,</span> <span class="keyword type">char</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">msg</span><span class="punctuation">,</span> <span class="name">Converter</span> <span class="keyword">const</span><span class="operator">&amp;</span> <span class="comment multiline">/* mesh */</span><span class="punctuation">)</span> <span class="punctuation">{</span>

    <span class="comment single">//
</span>    <span class="comment single">//  Optional topology validation error reporting:
</span>    <span class="comment single">//      This method is called whenever the factory encounters topology validation
</span>    <span class="comment single">//  errors. By default, nothing is reported
</span>    <span class="comment single">//
</span>    <span class="name">Warning</span><span class="punctuation">(</span><span class="name">msg</span><span class="punctuation">);</span>
<span class="punctuation">}</span>
<span class="name">template</span> <span class="operator">&lt;&gt;</span>
<span class="keyword type">bool</span>
<span class="name">TopologyRefinerFactory</span><span class="operator">&lt;</span><span class="name">Converter</span><span class="operator">&gt;::</span><span class="name">assignFaceVaryingTopology</span><span class="punctuation">(</span>
    <span class="name">TopologyRefiner</span> <span class="operator">&amp;</span> <span class="comment multiline">/* refiner */</span><span class="punctuation">,</span> <span class="name">Converter</span> <span class="keyword">const</span> <span class="operator">&amp;</span> <span class="comment multiline">/* conv */</span><span class="punctuation">)</span> <span class="punctuation">{</span>

    <span class="comment single">// Because of the way MSVC++ specializes templated functions, we had to
</span>    <span class="comment single">// remove the default stubs in Far::TopologyRefinerFactory. In this
</span>    <span class="comment single">// example, no face-varying data is being added, but we still need to
</span>    <span class="comment single">// implement a template specialization or MSVC++ linker fails.
</span>    <span class="keyword">return</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="comment preproc">#endif
</span>
<span class="punctuation">}</span> <span class="comment single">// namespace Far
</span>
<span class="punctuation">}</span> <span class="comment single">// namespace OPENSUBDIV_VERSION
</span><span class="punctuation">}</span> <span class="comment single">// namespace OpenSubdiv
</span>
<span class="comment single">//------------------------------------------------------------------------------
//
// Vertex container implementation.
//
</span><span class="keyword">struct</span> <span class="name">Vertex</span> <span class="punctuation">{</span>

    <span class="comment single">// Minimal required interface ----------------------
</span>    <span class="name">Vertex</span><span class="punctuation">()</span> <span class="punctuation">{</span> <span class="punctuation">}</span>

    <span class="name">Vertex</span><span class="punctuation">(</span><span class="name">Vertex</span> <span class="keyword">const</span> <span class="operator">&amp;</span> <span class="name">src</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">src</span><span class="punctuation">.</span><span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">];</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">src</span><span class="punctuation">.</span><span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">];</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">src</span><span class="punctuation">.</span><span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">];</span>
    <span class="punctuation">}</span>

    <span class="keyword type">void</span> <span class="name">Clear</span><span class="punctuation">(</span> <span class="keyword type">void</span> <span class="operator">*</span> <span class="operator">=</span><span class="literal number integer">0</span> <span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span><span class="operator">=</span><span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span><span class="operator">=</span><span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]</span><span class="operator">=</span><span class="literal number float">0.0f</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>

    <span class="keyword type">void</span> <span class="name">AddWithWeight</span><span class="punctuation">(</span><span class="name">Vertex</span> <span class="keyword">const</span> <span class="operator">&amp;</span> <span class="name">src</span><span class="punctuation">,</span> <span class="keyword type">float</span> <span class="name">weight</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span><span class="operator">+=</span><span class="name">weight</span><span class="operator">*</span><span class="name">src</span><span class="punctuation">.</span><span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">];</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span><span class="operator">+=</span><span class="name">weight</span><span class="operator">*</span><span class="name">src</span><span class="punctuation">.</span><span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">];</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]</span><span class="operator">+=</span><span class="name">weight</span><span class="operator">*</span><span class="name">src</span><span class="punctuation">.</span><span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">];</span>
    <span class="punctuation">}</span>

    <span class="keyword type">void</span> <span class="name">AddVaryingWithWeight</span><span class="punctuation">(</span><span class="name">Vertex</span> <span class="keyword">const</span> <span class="operator">&amp;</span><span class="punctuation">,</span> <span class="keyword type">float</span><span class="punctuation">)</span> <span class="punctuation">{</span> <span class="punctuation">}</span>

    <span class="comment single">// Public interface ------------------------------------
</span>    <span class="keyword type">void</span> <span class="name">SetPosition</span><span class="punctuation">(</span><span class="keyword type">float</span> <span class="name">x</span><span class="punctuation">,</span> <span class="keyword type">float</span> <span class="name">y</span><span class="punctuation">,</span> <span class="keyword type">float</span> <span class="name">z</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span><span class="operator">=</span><span class="name">x</span><span class="punctuation">;</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span><span class="operator">=</span><span class="name">y</span><span class="punctuation">;</span>
        <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]</span><span class="operator">=</span><span class="name">z</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>

    <span class="keyword">const</span> <span class="keyword type">float</span> <span class="operator">*</span> <span class="name">GetPosition</span><span class="punctuation">()</span> <span class="keyword">const</span> <span class="punctuation">{</span>
        <span class="keyword">return</span> <span class="name">_position</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>

<span class="name label">private</span><span class="punctuation">:</span>
    <span class="keyword type">float</span> <span class="name">_position</span><span class="punctuation">[</span><span class="literal number integer">3</span><span class="punctuation">];</span>
<span class="punctuation">};</span>

<span class="comment single">//------------------------------------------------------------------------------
</span><span class="keyword type">int</span> <span class="name function">main</span><span class="punctuation">(</span><span class="keyword type">int</span><span class="punctuation">,</span> <span class="keyword type">char</span> <span class="operator">**</span><span class="punctuation">)</span> <span class="punctuation">{</span>

    <span class="name">Converter</span> <span class="name">conv</span><span class="punctuation">;</span>

    <span class="name">Far</span><span class="operator">::</span><span class="name">TopologyRefiner</span> <span class="operator">*</span> <span class="name">refiner</span> <span class="operator">=</span>
        <span class="name">Far</span><span class="operator">::</span><span class="name">TopologyRefinerFactory</span><span class="operator">&lt;</span><span class="name">Converter</span><span class="operator">&gt;::</span><span class="name">Create</span><span class="punctuation">(</span><span class="name">conv</span><span class="punctuation">,</span>
                <span class="name">Far</span><span class="operator">::</span><span class="name">TopologyRefinerFactory</span><span class="operator">&lt;</span><span class="name">Converter</span><span class="operator">&gt;::</span><span class="name">Options</span><span class="punctuation">(</span><span class="name">conv</span><span class="punctuation">.</span><span class="name">GetType</span><span class="punctuation">(),</span> <span class="name">conv</span><span class="punctuation">.</span><span class="name">GetOptions</span><span class="punctuation">()));</span>


    <span class="keyword type">int</span> <span class="name">maxlevel</span> <span class="operator">=</span> <span class="literal number integer">5</span><span class="punctuation">;</span>

    <span class="comment single">// Uniformly refine the topolgy up to 'maxlevel'
</span>    <span class="name">refiner</span><span class="operator">-&gt;</span><span class="name">RefineUniform</span><span class="punctuation">(</span><span class="name">Far</span><span class="operator">::</span><span class="name">TopologyRefiner</span><span class="operator">::</span><span class="name">UniformOptions</span><span class="punctuation">(</span><span class="name">maxlevel</span><span class="punctuation">));</span>


    <span class="comment single">// Allocate a buffer for vertex primvar data. The buffer length is set to
</span>    <span class="comment single">// be the sum of all children vertices up to the highest level of refinement.
</span>    <span class="name">std</span><span class="operator">::</span><span class="name">vector</span><span class="operator">&lt;</span><span class="name">Vertex</span><span class="operator">&gt;</span> <span class="name">vbuffer</span><span class="punctuation">(</span><span class="name">refiner</span><span class="operator">-&gt;</span><span class="name">GetNumVerticesTotal</span><span class="punctuation">());</span>
    <span class="name">Vertex</span> <span class="operator">*</span> <span class="name">verts</span> <span class="operator">=</span> <span class="operator">&amp;</span><span class="name">vbuffer</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">];</span>


    <span class="comment single">// Initialize coarse mesh positions
</span>    <span class="keyword type">int</span> <span class="name">nCoarseVerts</span> <span class="operator">=</span> <span class="name">g_nverts</span><span class="punctuation">;</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">i</span><span class="operator">&lt;</span><span class="name">nCoarseVerts</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">i</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="name">verts</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">].</span><span class="name">SetPosition</span><span class="punctuation">(</span><span class="name">g_verts</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">][</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="name">g_verts</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">][</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="name">g_verts</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">][</span><span class="literal number integer">2</span><span class="punctuation">]);</span>
    <span class="punctuation">}</span>


    <span class="comment single">// Interpolate vertex primvar data
</span>    <span class="name">Far</span><span class="operator">::</span><span class="name">PrimvarRefiner</span> <span class="name">primvarRefiner</span><span class="punctuation">(</span><span class="operator">*</span><span class="name">refiner</span><span class="punctuation">);</span>

    <span class="name">Vertex</span> <span class="operator">*</span> <span class="name">src</span> <span class="operator">=</span> <span class="name">verts</span><span class="punctuation">;</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">level</span> <span class="operator">=</span> <span class="literal number integer">1</span><span class="punctuation">;</span> <span class="name">level</span> <span class="operator">&lt;=</span> <span class="name">maxlevel</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">level</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="name">Vertex</span> <span class="operator">*</span> <span class="name">dst</span> <span class="operator">=</span> <span class="name">src</span> <span class="operator">+</span> <span class="name">refiner</span><span class="operator">-&gt;</span><span class="name">GetLevel</span><span class="punctuation">(</span><span class="name">level</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">).</span><span class="name">GetNumVertices</span><span class="punctuation">();</span>
        <span class="name">primvarRefiner</span><span class="punctuation">.</span><span class="name">Interpolate</span><span class="punctuation">(</span><span class="name">level</span><span class="punctuation">,</span> <span class="name">src</span><span class="punctuation">,</span> <span class="name">dst</span><span class="punctuation">);</span>
        <span class="name">src</span> <span class="operator">=</span> <span class="name">dst</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>


    <span class="punctuation">{</span> <span class="comment single">// Output OBJ of the highest level refined -----------
</span>
        <span class="name">Far</span><span class="operator">::</span><span class="name">TopologyLevel</span> <span class="keyword">const</span> <span class="operator">&amp;</span> <span class="name">refLastLevel</span> <span class="operator">=</span> <span class="name">refiner</span><span class="operator">-&gt;</span><span class="name">GetLevel</span><span class="punctuation">(</span><span class="name">maxlevel</span><span class="punctuation">);</span>

        <span class="keyword type">int</span> <span class="name">nverts</span> <span class="operator">=</span> <span class="name">refLastLevel</span><span class="punctuation">.</span><span class="name">GetNumVertices</span><span class="punctuation">();</span>
        <span class="keyword type">int</span> <span class="name">nfaces</span> <span class="operator">=</span> <span class="name">refLastLevel</span><span class="punctuation">.</span><span class="name">GetNumFaces</span><span class="punctuation">();</span>

        <span class="comment single">// Print vertex positions
</span>        <span class="keyword type">int</span> <span class="name">firstOfLastVerts</span> <span class="operator">=</span> <span class="name">refiner</span><span class="operator">-&gt;</span><span class="name">GetNumVerticesTotal</span><span class="punctuation">()</span> <span class="operator">-</span> <span class="name">nverts</span><span class="punctuation">;</span>

        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">vert</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">vert</span> <span class="operator">&lt;</span> <span class="name">nverts</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">vert</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword type">float</span> <span class="keyword">const</span> <span class="operator">*</span> <span class="name">pos</span> <span class="operator">=</span> <span class="name">verts</span><span class="punctuation">[</span><span class="name">firstOfLastVerts</span> <span class="operator">+</span> <span class="name">vert</span><span class="punctuation">].</span><span class="name">GetPosition</span><span class="punctuation">();</span>
            <span class="name">printf</span><span class="punctuation">(</span><span class="literal string">&quot;v %f %f %f</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span><span class="punctuation">,</span> <span class="name">pos</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="name">pos</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="name">pos</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]);</span>
        <span class="punctuation">}</span>

        <span class="comment single">// Print faces
</span>        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">face</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">face</span> <span class="operator">&lt;</span> <span class="name">nfaces</span><span class="punctuation">;</span> <span class="operator">++</span><span class="name">face</span><span class="punctuation">)</span> <span class="punctuation">{</span>

            <span class="name">Far</span><span class="operator">::</span><span class="name">ConstIndexArray</span> <span class="name">fverts</span> <span class="operator">=</span> <span class="name">refLastLevel</span><span class="punctuation">.</span><span class="name">GetFaceVertices</span><span class="punctuation">(</span><span class="name">face</span><span class="punctuation">);</span>

            <span class="comment single">// all refined Catmark faces should be quads
</span>            <span class="name">assert</span><span class="punctuation">(</span><span class="name">fverts</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">()</span><span class="operator">==</span><span class="literal number integer">4</span><span class="punctuation">);</span>

            <span class="name">printf</span><span class="punctuation">(</span><span class="literal string">&quot;f &quot;</span><span class="punctuation">);</span>
            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">vert</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">vert</span><span class="operator">&lt;</span><span class="name">fverts</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="operator">++</span><span class="name">vert</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="name">printf</span><span class="punctuation">(</span><span class="literal string">&quot;%d &quot;</span><span class="punctuation">,</span> <span class="name">fverts</span><span class="punctuation">[</span><span class="name">vert</span><span class="punctuation">]</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">);</span> <span class="comment single">// OBJ uses 1-based arrays...
</span>            <span class="punctuation">}</span>
            <span class="name">printf</span><span class="punctuation">(</span><span class="literal string">&quot;</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span><span class="punctuation">);</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="comment single">//------------------------------------------------------------------------------</span>
</pre>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2015-06-24 21:00 UTC.

</div>
</body>
</html>

          </div><!-- close topicLeftData-MainData -->
        </div><!-- close coursewareBackground -->
    </div> <!-- close mainContentContainer -->
</div> <!-- close center -->

<div class="clearBoth"></div>


<div class="center">

    <div class="copyrightFooter">
    </div>


<!-- BOTTOM NAVIGATION MENU -->
    <ul class="creatorFooterNav">
        <li class="" id="navbarId-23704">
            <a href="intro.html">User Docs</a>
        </li>
        <li class="" id="navbarId-23887">
            <a href="doxy_html/index.html">API Docs</a>
        </li>
        <li class="" id="navbarId-23944">
            <a href="release_notes.html">Release Notes</a>
        </li>
        <li class="" id="navbarId-23703">
            <a href="http://graphics.pixar.com/opensubdiv/forum.html">Forum</a>
        </li>
    </ul><!-- end bottom navigation menu -->

<div class="clearBoth"></div>
