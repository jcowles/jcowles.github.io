<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>hbr_tutorial_2.cpp</title>
<link rel="icon" type="image/png" href="images/icon.png">
<link rel="stylesheet" href="css/rst.css" type="text/css" />
<link rel="stylesheet" href="css/default.css" type="text/css" />
<link rel="stylesheet" href="css/flavor.css" type="text/css" />
<link rel="stylesheet" href="css/renderman-university.css" type="text/css" />
<link rel="stylesheet" href="css/pygments.css" type="text/css" />
<style>
#mainContentContainer {
    left: 15px;
    margin-left: 255px;
}
ul.creatorFooterNav {
    margin-left: 100px;
}
.navigation {
    background-color: #333333;
    margin-top: 10px;
    margin-left: 10px;
}
ul.creatorMainNav li a {
    font-size: 12px !important;
}
</style>
</head>
<body>

<div class="navigation">
    <br>
    <div class="searchBar">
        <form action="search.html">
            <input type="text" name="q" id="searchInput" />
            <input type="button" id="searchButton" onclick="this.form.submit();" value="Search" />
        </form>
    </div>
    <div class="quickLinks">
        <ul>
            <li><a href="intro.html">はじめに</a></li>
                <ul>
                    <li><a href="license.html">ライセンス (en)</a></li>
                    <li><a href="getting_started.html">始めよう (en)</a></li>
                    <li><a href="contributing.html">参加しよう (en)</a></li>
                    <li><a href="cmake_build.html">ビルド方法 (en)</a></li>
                    <li><a href="code_examples.html">コード例 (en)</a></li>
                    <li><a href="roadmap.html">ロードマップ (en)</a></li>
                </ul>
            <p></p>
            <li><a href="intro_30.html">リリース 3.0</a></li>
                <ul>
                    <li><a href="intro_30.html">概要</a></li>
                    <li><a href="porting.html">2.0から3.0への移植ガイド (en)</a></li>
                    <li><a href="compatibility.html">サブディビジョンの互換性 (en)</a></li>
                </ul>
            <p></p>
            <li><a href="subdivision_surfaces.html">サブディビジョンサーフェス</a>
                <ul>
                    <li><a href="subdivision_surfaces.html#introduction">はじめに</a></li>
                    <li><a href="subdivision_surfaces.html#arbitrary-topology">トポロジ</a></li>
                    <li><a href="subdivision_surfaces.html#uniform-subdivision">均一分割</a></li>
                    <li><a href="subdivision_surfaces.html#feature-adaptive-subdivision">適応分割</a></li>
                    <li><a href="subdivision_surfaces.html#boundary-interpolation-rules">境界補間則</a></li>
                    <li><a href="subdivision_surfaces.html#face-varying-interpolation-rules">面変化境界補間則</a></li>
                    <li><a href="subdivision_surfaces.html#semi-sharp-creases">セミシャープクリース</a></li>
                    <li><a href="mod_notes.html">モデリングのコツ (en)</a></li>
                </ul>
            </li>
            <p></p>
            <li><a href="api_overview.html">OpenSubdiv ユーザーガイド (en)</a>
                <ul>
                    <li><a href="api_overview.html">API概要 (en)</a>
                        <li><a href="sdc_overview.html">Sdc (en)</a></li>
                        <li><a href="vtr_overview.html">Vtr (en)</a></li>
                        <li><a href="far_overview.html">Far (en)</a></li>
                        <ul>
                            <li><a href="far_overview.html#far-topologyrefiner">Topology Refiner (en)</a></li>
                            <li><a href="far_overview.html#far-topologyrefinerfactory">Topology Refiner Factory (en)</a></li>
                            <li><a href="far_overview.html#far-primvarrefiner">Primvar Refiner (en)</a></li>
                            <li><a href="far_overview.html#far-patchtable">Patch Table (en)</a></li>
                            <li><a href="far_overview.html#far-stenciltable">Stencil Table v</a></li>
                        </ul>
                        <li><a href="osd_overview.html">Osd (en)</a></li>
                        <ul>
                            <li><a href="osd_shader_interface.html">シェーダインタフェース (en)</a></li>
                        </ul>
                    </li>
                    <p></p>
                    <li><a href="tutorials.html">チュートリアル (en)</a>
                    <p></p>
                    <li><a href="hbr_overview.html">過去の情報 (en)</a></li>
                    <ul>
                        <li><a href="hbr_overview.html">Hbr (en)</a></li>
                        <ul>
                            <li><a href="using_osd_hbr.html">Using Hbr (en)</a></li>
                        </ul>
                        <li><a href="hedits.html">階層エディット (en)</a></li>
                    </ul>
                </ul>
            </li>
            <p></p>
            <li><a href="additional_resources.html">追加情報 (en)</a>
                <ul>
                    <li><a href="http://graphics.pixar.com/opensubdiv/forum.html">フォーラム</a>
                    <li><a href="additional_resources.html#links">リンク</a>
                    <li><a href="additional_resources.html#videos">ビデオ</a>
                </ul>
            <p></p>
            <li><a href="release_notes.html">リリースノート</a>
            <p></p>
            <li><a href="doxy_html/index.html" target="_blank">Doxygen</a></li>
        </ul>
    </div>
    <br>
</div>

<div class="document" id="hbr-tutorial-2-cpp">
<h1 class="title">hbr_tutorial_2.cpp</h1>


    <div id="mainContentContainer">
        <div class="fullWidth headerColor">
            <div class="center">
                <div id="mainSiteNavigation">
                    <div class="homeRenderManLink">
                        <a href="http://graphics.pixar.com/opensubdiv/index.html"><img alt="OpenSubdiv Logo" src="images/opensubdiv_logo_header.png"></a>
                    </div>
          
					<!-- TOP NAVIGATION MENU -->
                    <ul class="creatorMainNav floatLeft" id="menu">
                        <li class="creatorMainNav">
                            <a href="release_notes.html">3.0.0</a>
                        </li>
                    </ul>
                    <ul class="creatorMainNav floatNav" id="menu">
                        <li class="mainSubNavigation marginR12 marginL12" id="navbarId-23704">
                            <a href="intro.html">User Docs</a>
                        </li>
                        <li class="mainSubNavigation marginR12 marginL12" id="navbarId-23887">
                            <a href="doxy_html/index.html">API Docs</a>
                        </li>
                        <li class="mainSubNavigation marginR12 marginL12" id="navbarId-23944">
                            <a href="release_notes.html">Release Notes</a>
                        </li>
                        <li class="mainSubNavigation marginR15 marginL12" id="navbarId-23703">
                            <a href="http://graphics.pixar.com/opensubdiv/forum.html">Forum</a>
                        </li>
                        <a class="blueButton marginR0 marginL0" style="width:70px" href="https://github.com/PixarAnimationStudios/OpenSubdiv">Github</a>
                    </ul>
                </div><!-- close mainSiteNavigation -->
            </div><!-- close center -->
        </div><!-- close fullWidth -->


        <div class="clearBoth"></div>
        
        <h1 class="articleContentTitle">hbr_tutorial_2.cpp</h1>
        
        <div class="clearBoth"></div>
        
        <hr>
        
        <div class="clearBoth"></div>
        
        <div class="coursewareBackground">

          <!-- <div class="topicLeftData-IntroPara"></div> -->
          <div class="topicLeftData-MainData">
<p><a class="reference external" href="https://github.com/PixarAnimationStudios/OpenSubdiv/blob/master/tutorials/hbr/tutorial_2/hbr_tutorial_2.cpp">https://github.com/PixarAnimationStudios/OpenSubdiv/blob/master/tutorials/hbr/tutorial_2/hbr_tutorial_2.cpp</a></p>
<hr class="docutils" />
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">/Users/tejima/dev/OpenSubdiv.jpdoc/build/documentation/hbr_tutorial_2.rst</tt>, line 9)</p>
<p>Cannot analyze code. Pygments package not found.</p>
<pre class="literal-block">
.. code:: c

    //------------------------------------------------------------------------------
    // Tutorial description:
    //
    // This tutorial shows how to subdivide uniformly a simple Hbr mesh. We are
    // building upon previous turtorials and assuming a fully instantiated mesh:
    // we start with an HbrMesh pointer initialized from the same pyramid shape
    // used in hbr_tutorial_0.
    //
    // We then apply the Refine() function sequentially to all the faces in the
    // mesh to generate several levels of uniform subdivision. The resulting data
    // is then dumped to the terminal in Wavefront OBJ format for inspection.
    //

    #include &lt;opensubdiv/hbr/mesh.h&gt;
    #include &lt;opensubdiv/hbr/catmark.h&gt;

    #include &lt;cassert&gt;
    #include &lt;cstdio&gt;


    //------------------------------------------------------------------------------
    //
    // For this tutorial, we have to flesh the Vertex class further. Note that now
    // the copy constructor, Clear() and AddwithWeight() methods have been
    // implemented to interpolate our float3 position data.
    //
    // This vertex specialization pattern leaves client-code free to implement
    // arbitrary vertex primvar data schemes (or none at all to conserve efficiency)
    //
    struct Vertex {

        // Hbr minimal required interface ----------------------
        Vertex() { }

        Vertex(int /*i*/) { }

        Vertex(Vertex const &amp; src) {
            _position[0] = src._position[0];
            _position[1] = src._position[1];
            _position[2] = src._position[2];
        }

        void Clear( void * =0 ) {
            _position[0]=_position[1]=_position[2]=0.0f;
        }

        void AddWithWeight(Vertex const &amp; src, float weight) {
            _position[0]+=weight*src._position[0];
            _position[1]+=weight*src._position[1];
            _position[2]+=weight*src._position[2];
        }

        void AddVaryingWithWeight(Vertex const &amp;, float) { }

        // Public interface ------------------------------------
        void SetPosition(float x, float y, float z) {
            _position[0]=x;
            _position[1]=y;
            _position[2]=z;
        }

        const float * GetPosition() const {
            return _position;
        }

    private:
        float _position[3];
    };

    typedef OpenSubdiv::HbrMesh&lt;Vertex&gt;      Hmesh;
    typedef OpenSubdiv::HbrFace&lt;Vertex&gt;      Hface;
    typedef OpenSubdiv::HbrVertex&lt;Vertex&gt;    Hvertex;
    typedef OpenSubdiv::HbrHalfedge&lt;Vertex&gt;  Hhalfedge;

    Hmesh * createMesh();

    //------------------------------------------------------------------------------
    int main(int, char **) {

        Hmesh * hmesh = createMesh();

        int maxlevel=2,    // 2 levels of subdivision
            firstface=0,   // marker to the first face index of level 2
            firstvertex=0; // marker to the first vertex index of level 2

        // Refine the mesh to 'maxlevel'
        for (int level=0; level&lt;maxlevel; ++level) {

            // Total number of faces in the mesh, across all levels
            //
            // Mote: this function iterates over the list of faces and can be slow
            int nfaces = hmesh-&gt;GetNumFaces();

            if (level==(maxlevel-1)) {
                // Save our vertex marker
                firstvertex = hmesh-&gt;GetNumVertices();
            }

            // Iterate over the faces of the current level of subdivision
            for (int face=firstface; face&lt;nfaces; ++face) {

                Hface * f = hmesh-&gt;GetFace(face);

                // Mote : hole tags would have to be dealt with here.
                f-&gt;Refine();
            }

            // Save our face index marker for the next level
            firstface = nfaces;
        }

        { // Output OBJ of the highest level refined -----------

            // Print vertex positions
            int nverts = hmesh-&gt;GetNumVertices();
            for (int vert=firstvertex; vert&lt;nverts; ++vert) {
                float const * pos = hmesh-&gt;GetVertex(vert)-&gt;GetData().GetPosition();
                printf(&quot;v %f %f %f\n&quot;, pos[0], pos[1], pos[2]);
            }

            // Print faces
            for (int face=firstface; face&lt;hmesh-&gt;GetNumFaces(); ++face) {

                Hface * f = hmesh-&gt;GetFace(face);

                assert(f-&gt;GetNumVertices()==4 );

                printf(&quot;f &quot;);
                for (int vert=0; vert&lt;4; ++vert) {

                    // OBJ uses 1-based arrays
                    printf(&quot;%d &quot;, f-&gt;GetVertex(vert)-&gt;GetID() - firstvertex + 1);
                }
                printf(&quot;\n&quot;);
            }
        }

    }

    //------------------------------------------------------------------------------
    // Creates an Hbr mesh
    //
    // see hbr_tutorial_0 and hbr_tutorial_1 for more details
    //
    Hmesh *
    createMesh() {

        // Pyramid geometry from catmark_pyramid.h
        static float verts[5][3] = {{ 0.0f,  0.0f,  2.0f},
                                    { 0.0f, -2.0f,  0.0f},
                                    { 2.0f,  0.0f,  0.0f},
                                    { 0.0f,  2.0f,  0.0f},
                                    {-2.0f,  0.0f,  0.0f}};

        static int nverts = 5,
                   nfaces = 5;

        static int facenverts[5] = { 3, 3, 3, 3, 4 };

        static int faceverts[16] = { 0, 1, 2,
                                     0, 2, 3,
                                     0, 3, 4,
                                     0, 4, 1,
                                     4, 3, 2, 1 };

        OpenSubdiv::HbrCatmarkSubdivision&lt;Vertex&gt; * catmark =
            new OpenSubdiv::HbrCatmarkSubdivision&lt;Vertex&gt;();

        Hmesh * hmesh = new Hmesh(catmark);

        // Populate the vertices
        Vertex v;
        for (int i=0; i&lt;nverts; ++i) {
            v.SetPosition(verts[i][0], verts[i][1], verts[i][2]);
            hmesh-&gt;NewVertex(i, v);
        }

        // Create the topology
        int * fv = faceverts;
        for (int i=0; i&lt;nfaces; ++i) {

            int nv = facenverts[i];

            bool valid = true;

            for(int j=0;j&lt;nv;j++) {

                Hvertex const * origin      = hmesh-&gt;GetVertex(fv[j]),
                              * destination = hmesh-&gt;GetVertex(fv[(j+1)%nv]);
                Hhalfedge const * opposite = destination-&gt;GetEdge(origin);

                // Make sure that the vertices exist in the mesh
                if (origin==NULL or destination==NULL) {
                    printf(&quot; An edge was specified that connected a nonexistent vertex\n&quot;);
                    valid=false;
                    break;
                }

                // Check for a degenerate edge
                if (origin == destination) {
                    printf(&quot; An edge was specified that connected a vertex to itself\n&quot;);
                    valid=false;
                    break;
                }

                // Check that no more than 2 faces are adjacent to the edge
                if (opposite and opposite-&gt;GetOpposite() ) {
                    printf(&quot; A non-manifold edge incident to more than 2 faces was found\n&quot;);
                    valid=false;
                    break;
                }

                // Check that the edge is unique and oriented properly
                if (origin-&gt;GetEdge(destination)) {
                    printf(&quot; An edge connecting two vertices was specified more than once.&quot;
                           &quot; It's likely that an incident face was flipped\n&quot;);
                    valid=false;
                    break;
                }
            }

            if (valid) {
                hmesh-&gt;NewFace(nv, fv, 0);
            } else {
                printf(&quot; Skipped face %d\n&quot;, i);
            }

            fv+=nv;
        }

        hmesh-&gt;SetInterpolateBoundaryMethod(Hmesh::k_InterpolateBoundaryEdgeOnly);

        hmesh-&gt;Finish();

        return hmesh;
    }


    //------------------------------------------------------------------------------

</pre>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2015-06-24 04:40 UTC.

</div>
</body>
</html>

          </div><!-- close topicLeftData-MainData -->
        </div><!-- close coursewareBackground -->
    </div> <!-- close mainContentContainer -->
</div> <!-- close center -->

<div class="clearBoth"></div>


<div class="center">

    <div class="copyrightFooter">
    </div>


<!-- BOTTOM NAVIGATION MENU -->
    <ul class="creatorFooterNav">
        <li class="" id="navbarId-23704">
            <a href="intro.html">User Docs</a>
        </li>
        <li class="" id="navbarId-23887">
            <a href="doxy_html/index.html">API Docs</a>
        </li>
        <li class="" id="navbarId-23944">
            <a href="release_notes.html">Release Notes</a>
        </li>
        <li class="" id="navbarId-23703">
            <a href="http://graphics.pixar.com/opensubdiv/forum.html">Forum</a>
        </li>
    </ul><!-- end bottom navigation menu -->

<div class="clearBoth"></div>
